import{k,c as t,K as Ce,i as n,F as R,O as se,a9 as Oe,aa as ke,ab as ze,ac as Ke,ad as Me,S as _e,b as w,d as m,a5 as ee,a2 as Ge,a3 as Re,N as pe,q as Se,ae as re,af as Le,ag as Ae,m as je,ah as Ve,ai as He,aj as Ue,ak as Be,Y as ue,h as W,j as qe,p as We,a7 as Ye,A as O,g as j,t as V,al as Ze,am as Je,M as Xe,P as te,an as ge,ao as me,ap as Qe,aq as et,D as tt,e as nt}from"./vendor-K_-04A7A.js";import{c as st,g as rt,a as at,b as lt,d as ot,e as it,f as Y,r as ct}from"./index-UYRUd8DB.js";import{u as Z,B as P,f as dt,g as ut,h as gt,T as mt,i as U,j as xe,k as Ie,M as ye,m as ae,n as ft,o as u,p as fe,q as he,r as be,v as ht,w as bt,x as $t,y as vt}from"./index-BoT1VxDL.js";import{C as ne}from"./ConfigTitle-j1HkXMNR.js";import{f as Ct}from"./global-4bxjxrPj.js";const _t=m('<form><div class="join flex"><select name=sourceIP class="select join-item select-bordered"><option></option></select><input name=tagName class="input join-item input-bordered min-w-0 flex-1"placeholder=name>'),pt=m("<option class=badge>"),St=m('<div><div class="flex justify-between py-2"><div class="flex items-center gap-2"><span></span></div><input type=checkbox class=toggle>'),xt=m("<div>"),It=m('<div class="flex flex-col gap-4"><div><select class="select select-bordered w-full"></select></div><div><div class="flex flex-col gap-4"><div class="flex flex-col gap-2"></div></div></div><div>'),yt=m("<option>"),Ft=m('<div class="badge badge-primary w-full items-center justify-between gap-2 py-4"><span class=truncate> (<!>)'),wt=()=>{const r=ee.object({tagName:ee.string().nonempty(),sourceIP:ee.string().nonempty()}),[g]=Z(),{form:a,reset:C}=Ge({extend:Re({schema:r}),onSubmit:({tagName:b,sourceIP:y})=>{xe(_=>_.some(o=>o.tagName===b||o.sourceIP===y)?_:[..._,{tagName:b,sourceIP:y}]),C()}});return(()=>{const b=_t(),y=b.firstChild,_=y.firstChild;return _.firstChild,_.nextSibling,pe(a,b,()=>a),n(_,t(re,{get each(){return Se.uniq(ae().map(({metadata:{sourceIP:o}})=>o)).sort().filter(o=>!U().some(({sourceIP:c})=>c===o))},children:o=>(()=>{const c=pt();return n(c,o),w(()=>c.value=o()),c})()}),null),n(y,t(P,{type:"submit",class:"join-item",get children(){return g("tag")}}),null),b})()},Dt=r=>{const[g]=Z(),[a,C]=k(null),b=({draggable:o})=>C(o.id),y=({draggable:o,droppable:c})=>{if(o&&c){const p=r.order,f=p.indexOf(o.id),I=p.indexOf(c.id);if(f!==I){const S=p.slice();S.splice(I,0,...S.splice(f,1)),r.onOrderChange(S)}}},_=({key:o})=>{const c=Le(o),[p]=Ae();return(()=>{const f=St(),I=f.firstChild,S=I.firstChild,z=S.firstChild,h=S.nextSibling,F=c.ref;return typeof F=="function"?pe(F,f):c.ref=f,n(S,t(P,je({class:"btn-ghost btn-sm cursor-grab",get icon(){return t(Ve,{size:24})}},()=>c.dragActivators)),z),n(z,()=>g(o)),h.addEventListener("change",$=>{r.onVisibleChange({...r.visible,[o]:$.target.checked})}),w($=>{const T=!!c.isActiveDraggable,K=!!p.active.draggable,L=He(c.transform);return T!==$._v$&&f.classList.toggle("opacity-25",$._v$=T),K!==$._v$2&&f.classList.toggle("transition-transform",$._v$2=K),$._v$3=Ue(f,L,$._v$3),$},{_v$:void 0,_v$2:void 0,_v$3:void 0}),w(()=>h.checked=r.visible[o]),f})()};return t(ye,{ref:o=>{var c;return(c=r.ref)==null?void 0:c.call(r,o)},get icon(){return t(Ce,{size:24})},get title(){return g("connectionsSettings")},get action(){return t(P,{class:"btn-neutral btn-sm",onClick:()=>{r.onOrderChange(dt),r.onVisibleChange(ut)},get children(){return g("reset")}})},get children(){const o=It(),c=o.firstChild,p=c.firstChild,f=c.nextSibling,I=f.firstChild,S=I.firstChild,z=f.nextSibling;return n(c,t(ne,{withDivider:!0,get children(){return g("tableSize")}}),p),p.addEventListener("change",h=>gt(h.target.value)),n(p,t(R,{get each(){return Object.values(mt)},children:h=>(()=>{const F=yt();return F.value=h,n(F,()=>g(h)),F})()})),n(f,t(ne,{withDivider:!0,get children(){return g("tagClientSourceIPWithName")}}),I),n(I,t(wt,{}),S),n(S,t(R,{get each(){return U()},children:({tagName:h,sourceIP:F})=>(()=>{const $=Ft(),T=$.firstChild,K=T.firstChild,L=K.nextSibling;return L.nextSibling,n(T,h,K),n(T,F,L),n($,t(P,{class:"btn-circle btn-ghost btn-xs",onClick:()=>xe(M=>M.filter(A=>A.tagName!==h)),get icon(){return t(se,{size:12})}}),null),$})()})),n(z,t(ne,{withDivider:!0,get children(){return g("sort")}}),null),n(z,t(Oe,{onDragStart:b,onDragEnd:y,collisionDetector:ke,get children(){return[t(ze,{}),t(Ke,{get ids(){return r.order},get children(){return t(R,{get each(){return r.order},children:h=>t(_,{key:h})})}}),t(Me,{get children(){return t(_e,{get when(){return a()},get children(){const h=xt();return n(h,()=>g(a())),h}})}})]}}),null),w(()=>p.value=Ie()),o}})},Pt=m("<pre><code>"),Tt=r=>{const[g]=Z();return t(ye,{ref:a=>{var C;return(C=r.ref)==null?void 0:C.call(r,a)},get icon(){return t(Ce,{size:24})},get title(){return g("connectionsDetails")},get children(){return t(_e,{get when(){return r.selectedConnectionID},get children(){const a=Pt(),C=a.firstChild;return n(C,()=>JSON.stringify(ae().find(({id:b})=>b===r.selectedConnectionID),null,2)),a}})}})};var Nt=async r=>{typeof r=="string"?await navigator.clipboard.writeText(r):await navigator.clipboard.write(r)};const $e=m('<div class="flex h-4 items-center">'),Et=m('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="flex items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><select class="select select-bordered select-primary select-sm w-full max-w-full flex-1"><option value=""></option></select></div><div class="flex flex-1 items-center gap-2"><input type=search class="input input-primary input-sm min-w-0 flex-1"><input class=toggle type=checkbox></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Ot=m('<button><span></span><div class="badge badge-sm">'),kt=m("<option>"),zt=m("<tr>"),Kt=m("<th class=bg-base-200><div><div>"),Mt=m("<button class=cursor-pointer>"),Gt=m('<tr class="hover:!bg-primary hover:text-primary-content">'),Rt=m("<td class=py-2>"),Lt=m("<button><div></div><div></div><div>(<!>)");var H=function(r){return r[r.activeConnections=0]="activeConnections",r[r.closedConnections=1]="closedConnections",r}(H||{});const ve=(r,g,a,C)=>{const b=ct(r.getValue(g),a);return C({itemRank:b}),b.passed},Bt=()=>{let r,g;const[a]=Z(),[C,b]=k(H.activeConnections),{activeConnections:y,closedConnections:_,paused:o,setPaused:c}=ft(),[p,f]=k(""),[I,S]=k(!0),[z,h]=k(),F=[{header:()=>a("details"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Details,cell:({row:e})=>(()=>{const i=$e();return n(i,t(P,{class:"btn-circle btn-xs",onClick:()=>{h(e.original.id),g==null||g.showModal()},get icon(){return t(Be,{size:"16"})}})),i})()},{header:()=>a("close"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Close,cell:({row:e})=>(()=>{const i=$e();return n(i,t(P,{class:"btn-circle btn-xs",onClick:()=>fe(e.original.id),get icon(){return t(se,{size:"16"})}})),i})()},{header:()=>a("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:e=>e.id},{header:()=>a("type"),accessorKey:u.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>a("process"),accessorKey:u.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>a("host"),accessorKey:u.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>a("sniffHost"),accessorKey:u.SniffHost,accessorFn:e=>e.metadata.sniffHost||"-"},{header:()=>a("rules"),accessorKey:u.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>a("chains"),accessorKey:u.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>a("connectTime"),enableGrouping:!1,accessorKey:u.ConnectTime,accessorFn:e=>Ct(e.start),sortingFn:(e,i)=>ue(e.original.start).valueOf()-ue(i.original.start).valueOf()},{header:()=>a("dlSpeed"),enableGrouping:!1,accessorKey:u.DlSpeed,accessorFn:e=>`${W(e.downloadSpeed)}/s`,sortingFn:(e,i)=>e.original.downloadSpeed-i.original.downloadSpeed},{header:()=>a("ulSpeed"),enableGrouping:!1,accessorKey:u.ULSpeed,accessorFn:e=>`${W(e.uploadSpeed)}/s`,sortingFn:(e,i)=>e.original.uploadSpeed-i.original.uploadSpeed},{header:()=>a("dl"),enableGrouping:!1,accessorKey:u.Download,accessorFn:e=>W(e.download),sortingFn:(e,i)=>e.original.download-i.original.download},{header:()=>a("ul"),enableGrouping:!1,accessorKey:u.Upload,accessorFn:e=>W(e.upload),sortingFn:(e,i)=>e.original.upload-i.original.upload},{header:()=>a("sourceIP"),accessorKey:u.SourceIP,accessorFn:e=>{const i=U().find(B=>B.sourceIP===e.metadata.sourceIP);return i?i.tagName:e.metadata.sourceIP}},{header:()=>a("sourcePort"),accessorKey:u.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>a("destination"),accessorKey:u.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{header:()=>a("inboundUser"),accessorKey:u.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],[$,T]=k([]),[K,L]=qe(k([{id:u.ConnectTime,desc:!0}]),{name:"connectionsTableSorting",storage:localStorage}),M=st({filterFns:{fuzzy:ve},state:{get columnOrder(){return he()},get grouping(){return $()},get sorting(){return K()},get columnVisibility(){return be()},get globalFilter(){return p()}},get data(){const e=C()===H.activeConnections?y():_();return I()?e.filter(i=>!(i.chains.includes("Direct")||i.chains.includes("DNS"))):e},sortDescFirst:!0,enableHiding:!0,columns:F,onGlobalFilterChange:f,globalFilterFn:ve,onGroupingChange:T,onSortingChange:L,getFilteredRowModel:rt(),getSortedRowModel:at(),getExpandedRowModel:lt(),getGroupedRowModel:ot(),getCoreRowModel:it()}),A=M.getFlatHeaders().find(({id:e})=>e===u.SourceIP),[J,Fe]=k("");We(Ye(J,()=>{const e=U().find(i=>i.sourceIP===J());A==null||A.column.setFilterValue(e?e.tagName:J())}));const we=O(()=>[{type:H.activeConnections,name:a("active"),count:y().length},{type:H.closedConnections,name:a("closed"),count:_().length}]);return(()=>{const e=Et(),i=e.firstChild,B=i.firstChild,le=B.firstChild,X=le.nextSibling,De=X.firstChild,q=B.nextSibling,Q=q.firstChild,oe=Q.nextSibling,Pe=i.nextSibling,ie=Pe.firstChild,ce=ie.firstChild,Te=ce.nextSibling;return n(le,t(re,{get each(){return we()},children:s=>(()=>{const d=Ot(),l=d.firstChild,N=l.nextSibling;return d.$$click=()=>b(s().type),n(l,()=>s().name),n(N,()=>s().count),w(()=>j(d,V(C()===s().type&&"tab-active","tab-sm tab gap-2"))),d})()})),X.addEventListener("change",s=>Fe(s.target.value)),n(De,()=>a("all")),n(X,t(re,{get each(){return Se.uniq(ae().map(({metadata:{sourceIP:s}})=>{const d=U().find(l=>l.sourceIP===s);return d?d.tagName:s})).sort()},children:s=>(()=>{const d=kt();return n(d,s),w(()=>d.value=s()),d})()}),null),Q.$$input=s=>f(s.target.value),oe.addEventListener("change",s=>S(s.target.checked)),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>c(s=>!s),get icon(){return O(()=>!!o())()?t(Ze,{}):t(Je,{})}}),null),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>{M.getState().globalFilter?M.getFilteredRowModel().rows.forEach(({original:s})=>{fe(s.id)}):ht()},get icon(){return t(se,{})}}),null),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>r==null?void 0:r.showModal(),get icon(){return t(Xe,{})}}),null),n(ce,t(R,{get each(){return M.getHeaderGroups()},children:s=>(()=>{const d=zt();return n(d,t(R,{get each(){return s.headers},children:l=>(()=>{const N=Kt(),E=N.firstChild,v=E.firstChild;return n(E,(()=>{const x=O(()=>!!l.column.getCanGroup());return()=>x()?(()=>{const D=Mt();return te(D,"click",l.column.getToggleGroupingHandler(),!0),n(D,(()=>{const G=O(()=>!!l.column.getIsGrouped());return()=>G()?t(ge,{size:18}):t(me,{size:18})})()),D})():null})(),v),te(v,"click",l.column.getToggleSortingHandler(),!0),n(v,()=>Y(l.column.columnDef.header,l.getContext())),n(E,()=>({asc:t(Qe,{}),desc:t(et,{})})[l.column.getIsSorted()]??null,null),w(x=>{const D=V("flex items-center gap-2"),G=V(l.column.getCanSort()&&"cursor-pointer select-none","flex-1");return D!==x._v$3&&j(E,x._v$3=D),G!==x._v$4&&j(v,x._v$4=G),x},{_v$3:void 0,_v$4:void 0}),N})()})),d})()})),n(Te,t(R,{get each(){return M.getRowModel().rows},children:s=>(()=>{const d=Gt();return n(d,t(R,{get each(){return s.getVisibleCells()},children:l=>(()=>{const N=Rt();return N.$$contextmenu=E=>{E.preventDefault();const v=l.renderValue();v&&Nt(v).catch(()=>{})},n(N,(()=>{const E=O(()=>!!l.getIsGrouped());return()=>E()?(()=>{const v=Lt(),x=v.firstChild,D=x.nextSibling,G=D.nextSibling,Ne=G.firstChild,de=Ne.nextSibling;return de.nextSibling,te(v,"click",s.getToggleExpandedHandler(),!0),n(x,(()=>{const Ee=O(()=>!!s.getIsExpanded());return()=>Ee()?t(ge,{size:18}):t(me,{size:18})})()),n(D,()=>Y(l.column.columnDef.cell,l.getContext())),n(G,()=>s.subRows.length,de),w(()=>j(v,V(s.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),v})():(()=>{const v=O(()=>!!l.getIsAggregated());return()=>v()?Y(l.column.columnDef.aggregatedCell??l.column.columnDef.cell,l.getContext()):(()=>{const x=O(()=>!!l.getIsPlaceholder());return()=>x()?null:Y(l.column.columnDef.cell,l.getContext())})()})()})()),N})()})),d})()})),n(e,t(Dt,{ref:s=>r=s,get order(){return he()},get visible(){return be()},onOrderChange:s=>bt(s),onVisibleChange:s=>$t({...s})}),null),n(e,t(Tt,{ref:s=>g=s,get selectedConnectionID(){return z()}}),null),w(s=>{const d=a("search"),l=V(vt(Ie()),"table table-zebra relative rounded-none");return d!==s._v$&&tt(Q,"placeholder",s._v$=d),l!==s._v$2&&j(ie,s._v$2=l),s},{_v$:void 0,_v$2:void 0}),w(()=>oe.checked=I()),e})()};nt(["input","click","contextmenu"]);export{Bt as default};
