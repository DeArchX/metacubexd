import{k,c as t,L as _e,i as n,F as R,P as se,a9 as ke,aa as ze,ab as Ge,ac as Ke,ad as Me,S as pe,b as w,d as m,a5 as ee,a2 as Re,a3 as Le,O as Se,q as xe,ae as re,af as Ae,ag as je,m as Ve,ah as He,ai as Ue,aj as Be,j as ue,ak as qe,v as ge,h as W,p as We,a7 as Ze,y as O,g as j,t as V,al as Ye,am as Je,N as Qe,Q as te,an as me,ao as fe,ap as Xe,aq as et,E as tt,e as nt}from"./vendor-XL6gZW1S.js";import{c as st,g as rt,a as at,b as lt,d as ot,e as it,f as Z,r as ct}from"./index-0roT6USE.js";import{u as Y,B as P,f as dt,g as ut,h as gt,T as mt,i as U,j as Ie,k as ye,M as Fe,m as ae,n as ft,o as u,p as he,q as ht,r as be,v as $e,w as bt,x as $t,y as vt,z as Ct}from"./index-Ex1sF_Zf.js";import{C as ne}from"./ConfigTitle-mdfEp71g.js";const _t=m('<form><div class="join flex"><select name=sourceIP class="select join-item select-bordered"><option></option></select><input name=tagName class="input join-item input-bordered min-w-0 flex-1"placeholder=name>'),pt=m("<option class=badge>"),St=m('<div><div class="flex justify-between py-2"><div class="flex items-center gap-2"><span></span></div><input type=checkbox class=toggle>'),xt=m("<div>"),It=m('<div class="flex flex-col gap-4"><div><select class="select select-bordered w-full"></select></div><div><div class="flex flex-col gap-4"><div class="flex flex-col gap-2"></div></div></div><div>'),yt=m("<option>"),Ft=m('<div class="badge badge-primary w-full items-center justify-between gap-2 py-4"><span class=truncate> (<!>)'),wt=()=>{const r=ee.object({tagName:ee.string().nonempty(),sourceIP:ee.string().nonempty()}),[g]=Y(),{form:a,reset:C}=Re({extend:Le({schema:r}),onSubmit:({tagName:b,sourceIP:y})=>{Ie(_=>_.some(o=>o.tagName===b||o.sourceIP===y)?_:[..._,{tagName:b,sourceIP:y}]),C()}});return(()=>{const b=_t(),y=b.firstChild,_=y.firstChild;return _.firstChild,_.nextSibling,Se(a,b,()=>a),n(_,t(re,{get each(){return xe.uniq(ae().map(({metadata:{sourceIP:o}})=>o)).sort().filter(o=>!U().some(({sourceIP:c})=>c===o))},children:o=>(()=>{const c=pt();return n(c,o),w(()=>c.value=o()),c})()}),null),n(y,t(P,{type:"submit",class:"join-item",get children(){return g("tag")}}),null),b})()},Dt=r=>{const[g]=Y(),[a,C]=k(null),b=({draggable:o})=>C(o.id),y=({draggable:o,droppable:c})=>{if(o&&c){const p=r.order,f=p.indexOf(o.id),I=p.indexOf(c.id);if(f!==I){const S=p.slice();S.splice(I,0,...S.splice(f,1)),r.onOrderChange(S)}}},_=({key:o})=>{const c=Ae(o),[p]=je();return(()=>{const f=St(),I=f.firstChild,S=I.firstChild,z=S.firstChild,h=S.nextSibling,F=c.ref;return typeof F=="function"?Se(F,f):c.ref=f,n(S,t(P,Ve({class:"btn-ghost btn-sm cursor-grab",get icon(){return t(He,{size:24})}},()=>c.dragActivators)),z),n(z,()=>g(o)),h.addEventListener("change",$=>{r.onVisibleChange({...r.visible,[o]:$.target.checked})}),w($=>{const T=!!c.isActiveDraggable,G=!!p.active.draggable,L=Ue(c.transform);return T!==$._v$&&f.classList.toggle("opacity-25",$._v$=T),G!==$._v$2&&f.classList.toggle("transition-transform",$._v$2=G),$._v$3=Be(f,L,$._v$3),$},{_v$:void 0,_v$2:void 0,_v$3:void 0}),w(()=>h.checked=r.visible[o]),f})()};return t(Fe,{ref:o=>{var c;return(c=r.ref)==null?void 0:c.call(r,o)},get icon(){return t(_e,{size:24})},get title(){return g("connectionsSettings")},get action(){return t(P,{class:"btn-neutral btn-sm",onClick:()=>{r.onOrderChange(dt),r.onVisibleChange(ut)},get children(){return g("reset")}})},get children(){const o=It(),c=o.firstChild,p=c.firstChild,f=c.nextSibling,I=f.firstChild,S=I.firstChild,z=f.nextSibling;return n(c,t(ne,{withDivider:!0,get children(){return g("tableSize")}}),p),p.addEventListener("change",h=>gt(h.target.value)),n(p,t(R,{get each(){return Object.values(mt)},children:h=>(()=>{const F=yt();return F.value=h,n(F,()=>g(h)),F})()})),n(f,t(ne,{withDivider:!0,get children(){return g("tagClientSourceIPWithName")}}),I),n(I,t(wt,{}),S),n(S,t(R,{get each(){return U()},children:({tagName:h,sourceIP:F})=>(()=>{const $=Ft(),T=$.firstChild,G=T.firstChild,L=G.nextSibling;return L.nextSibling,n(T,h,G),n(T,F,L),n($,t(P,{class:"btn-circle btn-ghost btn-xs",onClick:()=>Ie(K=>K.filter(A=>A.tagName!==h)),get icon(){return t(se,{size:12})}}),null),$})()})),n(z,t(ne,{withDivider:!0,get children(){return g("sort")}}),null),n(z,t(ke,{onDragStart:b,onDragEnd:y,collisionDetector:ze,get children(){return[t(Ge,{}),t(Ke,{get ids(){return r.order},get children(){return t(R,{get each(){return r.order},children:h=>t(_,{key:h})})}}),t(Me,{get children(){return t(pe,{get when(){return a()},get children(){const h=xt();return n(h,()=>g(a())),h}})}})]}}),null),w(()=>p.value=ye()),o}})},Pt=m("<pre><code>"),Tt=r=>{const[g]=Y();return t(Fe,{ref:a=>{var C;return(C=r.ref)==null?void 0:C.call(r,a)},get icon(){return t(_e,{size:24})},get title(){return g("connectionsDetails")},get children(){return t(pe,{get when(){return r.selectedConnectionID},get children(){const a=Pt(),C=a.firstChild;return n(C,()=>JSON.stringify(ae().find(({id:b})=>b===r.selectedConnectionID),null,2)),a}})}})};var Nt=async r=>{typeof r=="string"?await navigator.clipboard.writeText(r):await navigator.clipboard.write(r)};const ve=m('<div class="flex h-4 items-center">'),Et=m('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="flex items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><select class="select select-bordered select-primary select-sm w-full max-w-full flex-1"><option value=""></option></select></div><div class="flex flex-1 items-center gap-2"><input type=search class="input input-primary input-sm min-w-0 flex-1"><input class=toggle type=checkbox></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Ot=m('<button><span></span><div class="badge badge-sm">'),kt=m("<option>"),zt=m("<tr>"),Gt=m("<th class=bg-base-200><div><div>"),Kt=m("<button class=cursor-pointer>"),Mt=m('<tr class="hover:!bg-primary hover:text-primary-content">'),Rt=m("<td class=py-2>"),Lt=m("<button><div></div><div></div><div>(<!>)");var H=function(r){return r[r.activeConnections=0]="activeConnections",r[r.closedConnections=1]="closedConnections",r}(H||{});const Ce=(r,g,a,C)=>{const b=ct(r.getValue(g),a);return C({itemRank:b}),b.passed},Ut=()=>{let r,g;const[a]=Y(),[C,b]=k(H.activeConnections),{activeConnections:y,closedConnections:_,paused:o,setPaused:c}=ft(),[p,f]=k(""),[I,S]=ue(k(!0),{name:"directFilter",storage:localStorage}),[z,h]=k(),F=[{header:()=>a("details"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Details,cell:({row:e})=>(()=>{const i=ve();return n(i,t(P,{class:"btn-circle btn-xs",onClick:()=>{h(e.original.id),g==null||g.showModal()},get icon(){return t(qe,{size:"16"})}})),i})()},{header:()=>a("close"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Close,cell:({row:e})=>(()=>{const i=ve();return n(i,t(P,{class:"btn-circle btn-xs",onClick:()=>he(e.original.id),get icon(){return t(se,{size:"16"})}})),i})()},{header:()=>a("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:e=>e.id},{header:()=>a("type"),accessorKey:u.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>a("process"),accessorKey:u.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>a("host"),accessorKey:u.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>a("sniffHost"),accessorKey:u.SniffHost,accessorFn:e=>e.metadata.sniffHost||"-"},{header:()=>a("rules"),accessorKey:u.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>a("chains"),accessorKey:u.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>a("connectTime"),enableGrouping:!1,accessorKey:u.ConnectTime,accessorFn:e=>ht(e.start),sortingFn:(e,i)=>ge(e.original.start).valueOf()-ge(i.original.start).valueOf()},{header:()=>a("dlSpeed"),enableGrouping:!1,accessorKey:u.DlSpeed,accessorFn:e=>`${W(e.downloadSpeed)}/s`,sortingFn:(e,i)=>e.original.downloadSpeed-i.original.downloadSpeed},{header:()=>a("ulSpeed"),enableGrouping:!1,accessorKey:u.ULSpeed,accessorFn:e=>`${W(e.uploadSpeed)}/s`,sortingFn:(e,i)=>e.original.uploadSpeed-i.original.uploadSpeed},{header:()=>a("dl"),enableGrouping:!1,accessorKey:u.Download,accessorFn:e=>W(e.download),sortingFn:(e,i)=>e.original.download-i.original.download},{header:()=>a("ul"),enableGrouping:!1,accessorKey:u.Upload,accessorFn:e=>W(e.upload),sortingFn:(e,i)=>e.original.upload-i.original.upload},{header:()=>a("sourceIP"),accessorKey:u.SourceIP,accessorFn:e=>{const i=U().find(B=>B.sourceIP===e.metadata.sourceIP);return i?i.tagName:e.metadata.sourceIP}},{header:()=>a("sourcePort"),accessorKey:u.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>a("destination"),accessorKey:u.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{header:()=>a("inboundUser"),accessorKey:u.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],[$,T]=k([]),[G,L]=ue(k([{id:u.ConnectTime,desc:!0}]),{name:"connectionsTableSorting",storage:localStorage}),K=st({filterFns:{fuzzy:Ce},state:{get columnOrder(){return be()},get grouping(){return $()},get sorting(){return G()},get columnVisibility(){return $e()},get globalFilter(){return p()}},get data(){const e=C()===H.activeConnections?y():_();return I()?e.filter(i=>!(i.chains.includes("Direct")||i.chains.includes("DNS"))):e},sortDescFirst:!0,enableHiding:!0,columns:F,onGlobalFilterChange:f,globalFilterFn:Ce,onGroupingChange:T,onSortingChange:L,getFilteredRowModel:rt(),getSortedRowModel:at(),getExpandedRowModel:lt(),getGroupedRowModel:ot(),getCoreRowModel:it()}),A=K.getFlatHeaders().find(({id:e})=>e===u.SourceIP),[J,we]=k("");We(Ze(J,()=>{const e=U().find(i=>i.sourceIP===J());A==null||A.column.setFilterValue(e?e.tagName:J())}));const De=O(()=>[{type:H.activeConnections,name:a("active"),count:y().length},{type:H.closedConnections,name:a("closed"),count:_().length}]);return(()=>{const e=Et(),i=e.firstChild,B=i.firstChild,le=B.firstChild,Q=le.nextSibling,Pe=Q.firstChild,q=B.nextSibling,X=q.firstChild,oe=X.nextSibling,Te=i.nextSibling,ie=Te.firstChild,ce=ie.firstChild,Ne=ce.nextSibling;return n(le,t(re,{get each(){return De()},children:s=>(()=>{const d=Ot(),l=d.firstChild,N=l.nextSibling;return d.$$click=()=>b(s().type),n(l,()=>s().name),n(N,()=>s().count),w(()=>j(d,V(C()===s().type&&"tab-active","tab-sm tab gap-2"))),d})()})),Q.addEventListener("change",s=>we(s.target.value)),n(Pe,()=>a("all")),n(Q,t(re,{get each(){return xe.uniq(ae().map(({metadata:{sourceIP:s}})=>{const d=U().find(l=>l.sourceIP===s);return d?d.tagName:s})).sort()},children:s=>(()=>{const d=kt();return n(d,s),w(()=>d.value=s()),d})()}),null),X.$$input=s=>f(s.target.value),oe.addEventListener("change",s=>S(s.target.checked)),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>c(s=>!s),get icon(){return O(()=>!!o())()?t(Ye,{}):t(Je,{})}}),null),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>{K.getState().globalFilter?K.getFilteredRowModel().rows.forEach(({original:s})=>{he(s.id)}):bt()},get icon(){return t(se,{})}}),null),n(q,t(P,{class:"btn-circle btn-sm",onClick:()=>r==null?void 0:r.showModal(),get icon(){return t(Qe,{})}}),null),n(ce,t(R,{get each(){return K.getHeaderGroups()},children:s=>(()=>{const d=zt();return n(d,t(R,{get each(){return s.headers},children:l=>(()=>{const N=Gt(),E=N.firstChild,v=E.firstChild;return n(E,(()=>{const x=O(()=>!!l.column.getCanGroup());return()=>x()?(()=>{const D=Kt();return te(D,"click",l.column.getToggleGroupingHandler(),!0),n(D,(()=>{const M=O(()=>!!l.column.getIsGrouped());return()=>M()?t(me,{size:18}):t(fe,{size:18})})()),D})():null})(),v),te(v,"click",l.column.getToggleSortingHandler(),!0),n(v,()=>Z(l.column.columnDef.header,l.getContext())),n(E,()=>({asc:t(Xe,{}),desc:t(et,{})})[l.column.getIsSorted()]??null,null),w(x=>{const D=V("flex items-center gap-2"),M=V(l.column.getCanSort()&&"cursor-pointer select-none","flex-1");return D!==x._v$3&&j(E,x._v$3=D),M!==x._v$4&&j(v,x._v$4=M),x},{_v$3:void 0,_v$4:void 0}),N})()})),d})()})),n(Ne,t(R,{get each(){return K.getRowModel().rows},children:s=>(()=>{const d=Mt();return n(d,t(R,{get each(){return s.getVisibleCells()},children:l=>(()=>{const N=Rt();return N.$$contextmenu=E=>{E.preventDefault();const v=l.renderValue();v&&Nt(v).catch(()=>{})},n(N,(()=>{const E=O(()=>!!l.getIsGrouped());return()=>E()?(()=>{const v=Lt(),x=v.firstChild,D=x.nextSibling,M=D.nextSibling,Ee=M.firstChild,de=Ee.nextSibling;return de.nextSibling,te(v,"click",s.getToggleExpandedHandler(),!0),n(x,(()=>{const Oe=O(()=>!!s.getIsExpanded());return()=>Oe()?t(me,{size:18}):t(fe,{size:18})})()),n(D,()=>Z(l.column.columnDef.cell,l.getContext())),n(M,()=>s.subRows.length,de),w(()=>j(v,V(s.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),v})():(()=>{const v=O(()=>!!l.getIsAggregated());return()=>v()?Z(l.column.columnDef.aggregatedCell??l.column.columnDef.cell,l.getContext()):(()=>{const x=O(()=>!!l.getIsPlaceholder());return()=>x()?null:Z(l.column.columnDef.cell,l.getContext())})()})()})()),N})()})),d})()})),n(e,t(Dt,{ref:s=>r=s,get order(){return be()},get visible(){return $e()},onOrderChange:s=>$t(s),onVisibleChange:s=>vt({...s})}),null),n(e,t(Tt,{ref:s=>g=s,get selectedConnectionID(){return z()}}),null),w(s=>{const d=a("search"),l=V(Ct(ye()),"table table-zebra relative rounded-none");return d!==s._v$&&tt(X,"placeholder",s._v$=d),l!==s._v$2&&j(ie,s._v$2=l),s},{_v$:void 0,_v$2:void 0}),w(()=>oe.checked=I()),e})()};nt(["input","click","contextmenu"]);export{Ut as default};
